<?xml version="1.0" encoding="utf-8"?>
<configuration>
	<!-- This configuration file sets up IIS to always serve the index.html file
    which is the entry point for the React app. THis is needed anywhere the site is deployed
    and hosted by IIS -->
	<location path="." inheritInChildApplications="false">
		<system.webServer>
			<rewrite>
				<rules>
                    <clear />
                    <rule name="Maintenance Screen" enabled="false" stopProcessing="true">
                        <match url="(.*)" />
                        <conditions logicalGrouping="MatchAll" trackAllCaptures="false">
                            <add input="{REQUEST_URI}" pattern="maintenance.html" negate="true" />
                        </conditions>
                        <action type="Redirect" url="https://{HTTP_HOST}/maintenance.html" appendQueryString="false" redirectType="Temporary" />
                    </rule>
					<rule name="HTTP to HTTPS" enabled="true" stopProcessing="true">
                        <match url="(.*)" />
                        <conditions logicalGrouping="MatchAll" trackAllCaptures="false">
                            <add input="{HTTPS}" pattern="^OFF$" />
                        </conditions>
                        <action type="Redirect" url="https://{HTTP_HOST}{REQUEST_URI}" appendQueryString="false" redirectType="Permanent" />
                    </rule>
                    <rule name="Corvus Rewrites" stopProcessing="true">
                        <match url="Product\.aspx" />
                        <conditions logicalGrouping="MatchAll" trackAllCaptures="false">
                            <add input="{AWRewriter:{REQUEST_URI}}" pattern="(.+)" />
                        </conditions>
                        <action type="Redirect" url="{C:1}" />
                    </rule>
                    <rule name="SPA Routes" stopProcessing="true">
                        <match url=".*" />
                        <conditions logicalGrouping="MatchAll" trackAllCaptures="false">
                            <add input="{REQUEST_FILENAME}" matchType="IsFile" negate="true" />
                            <add input="{REQUEST_FILENAME}" matchType="IsDirectory" negate="true" />
                            <add input="{REQUEST_URI}" pattern="^/(graphql)" negate="true" />
                            <add input="{REQUEST_URI}" pattern="^/(ui/playground)" negate="true" />
                            <add input="{REQUEST_URI}" pattern="/api/publicprice(/.*)$" negate="true" />
                        </conditions>
                        <action type="Rewrite" url="/index.html" />
                    </rule>
				</rules>
			</rewrite>
		</system.webServer>
	</location>
	<location path="index.html">
		<system.webServer>
			<httpProtocol>
				<customHeaders>
					<add name="Cache-Control" value="no-cache" />
				</customHeaders>
			</httpProtocol>
		</system.webServer>
	</location>
	<system.webServer>
        <rewrite>
            <providers>
                <remove name="AWRewriter" />
                <provider name="AWRewriter" type="AirlineWebRedirectProvider.Rewriter">
                    <settings>
                        <add key="AirlineAPIUrl" value="#{ApiURL}" />
                    </settings>
                </provider>
            </providers>
        </rewrite>
    </system.webServer>
</configuration>